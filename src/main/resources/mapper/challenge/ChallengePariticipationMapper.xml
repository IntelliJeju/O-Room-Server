<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.savit.challenge.mapper.ChallengeParticipationMapper">

    <!-- 참여 여부 확인 -->
    <select id="existsParticipation" resultType="boolean">
        SELECT EXISTS (
            SELECT 1 FROM ChallengeParticipation
            WHERE challenge_id = #{challengeId} AND user_id = #{userId}
        )
    </select>

    <!-- 챌린지 참여 삽입 -->
    <insert id="insertParticipation">
        INSERT INTO ChallengeParticipation (
            challenge_id, user_id, status, my_fee, created_at
        ) VALUES (
                     #{challengeId}, #{userId}, 'PARTICIPATING', #{myFee}, NOW()
                 )
    </insert>

    <!-- challenge 타입 amount 일때, 참여자들 현황 -->
    <select id="selectParticipantsWithAmount" resultType="com.savit.challenge.dto.ParticipantInfo">
        select u.nickname          as nickName,
               cp.challenge_amount as challengeAmount,
               cp.status
        from challengeParticipation as cp
                 inner join user as u
                            on cp.user_id = u.id
        where cp.challenge_id = #{challengeId}
    </select>

    <!-- challenge 타입 count 일때, 참여자들 현황-->
    <select id="selectParticipantsWithCount" resultType="com.savit.challenge.dto.ParticipantInfo">
        select u.nickname as nickName, cp.challenge_count as challengeCount, cp.status
        from challengeParticipation as cp
                 inner join user as u on cp.user_id = u.id
        where cp.challenge_id = #{challengeId}
    </select>


</mapper>