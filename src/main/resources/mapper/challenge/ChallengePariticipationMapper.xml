<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.savit.challenge.mapper.ChallengeParticipationMapper">

    <!-- 참여 여부 확인 -->
    <select id="existsParticipation" resultType="boolean">
        SELECT EXISTS (SELECT 1
                       FROM ChallengeParticipation
                       WHERE challenge_id = #{challengeId}
                         AND user_id = #{userId})
    </select>

    <!-- 챌린지 참여 삽입 -->
    <insert id="insertParticipation">
        INSERT INTO ChallengeParticipation (challenge_id, user_id, status, my_fee, created_at)
        VALUES (#{challengeId}, #{userId}, 'PARTICIPATING', #{myFee}, NOW())
    </insert>

    <!--my_fee 합치기-->
    <select id="sumMyFeeByChallenge" resultType="java.math.BigDecimal">
        select coalesce(sum(my_fee), 0)
        from challengeParticipation
        where challenge_id = #{challengeId}

    </select>
</mapper>